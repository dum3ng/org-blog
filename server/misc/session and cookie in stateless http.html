<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>session and cookie in stateless http</title>
<!-- 2017-11-13 Mon 19:39 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="杜猛" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">session and cookie in stateless http</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. use by api consumer</a></li>
<li><a href="#sec-2">2. Security issue</a></li>
</ul>
</div>
</div>
<p>
<span class="timestamp-wrapper"><span class="timestamp">&lt;2016-10-29 Sat&gt;</span></span>
</p>

<p>
The http is a stateless protocol, which means that the requests does not recognize between each other and every request is new for the server.
So to make a stateful application, we must adopt some mechanism to make the server know which client the request comes from.
If you make a <code>GET</code> request with correct credentials to the server, then the server will make a response with headers contains such items:
</p>

<div class="org-src-container">

<pre class="src src-js">  <span style="color: #DCDCCC;">{</span>
    ...:...,
    Set-Cookie: session-id=xxxxxx; expires=xxxxx; path= <span style="color: #CC9393;">/;</span>
<span style="color: #CC9393;">    Set-Cookie: username=xxxx; expires=xxxx; path=/</span>;
    ...:...
  <span style="color: #DCDCCC;">}</span>
</pre>
</div>

<p>
Then the client( your browser ) will set cookies on your device. Check the cookie in your browser on that site, you can see that cookie now contain the key-value has the infomation in just the response header.
</p>

<p>
After logged in successfully, every request will contain header infomation :
</p>

<div class="org-src-container">

<pre class="src src-js">  <span style="color: #DCDCCC;">{</span>
    ...:...,
    Cookie: username=xxxx; session-id=xxxxxx;  <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">and other cookies infomation</span>
    ...:...,
  <span style="color: #DCDCCC;">}</span>
</pre>
</div>

<p>
When you want to log out the site, the client will make a <code>POST</code> request to the server, commonly will be an address like <code>https://example.com/logout</code>, and the server will make a response with header contains also cookie info:
</p>

<div class="org-src-container">

<pre class="src src-js">  <span style="color: #DCDCCC;">{</span>
    ...:...,
    Set-Cookie: session-id=; path=<span style="color: #CC9393;">/; max-age=0; expires=Thu, 01 Jan 1970 00:00:00 -0000 ,</span>
<span style="color: #CC9393;">    Set-Cookie: username=; path=/</span>; max-age=0; expires=Thu, 01 Jan 1970 00:00:00 -0000,
    Location: https:<span style="color: #5F7F5F;">//</span><span style="color: #7F9F7F;">github.com/,</span>
    ...:...,
  <span style="color: #DCDCCC;">}</span>
</pre>
</div>

<p>
Then the client will erase the coresponding key in the cookie. And often the server will also send a redirect information, that is the <code>Location</code> header, then the client will goto that address, normally will be the homepage.
</p>

<p>
As we can see, the statefulness is achieved by add session information in the request and response headers. At client side, the infos are stored in <code>cookies</code>, and will be persistly on. At server side, the infos are stored either in memory or in a database.
</p>

<p>
If you manually delete the cookies, you will be logged out.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> use by api consumer</h2>
<div class="outline-text-2" id="text-1">
<p>
Above is the situation in brower environment, and the cookie set by <code>Set-Cookie</code> can not get directly by the user or customized script. The work are done by the client at deep.
If you are making a mobile app with the net communication capability, you can set the customized property in the request header and response header, and store the token in some safe place on your mobile device (such as the key-chain in iOS).
</p>
</div>
</div>


<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Security issue</h2>
<div class="outline-text-2" id="text-2">
<p>
Since the state if only relied on the session-id, which means if one has the session-id and make a request with this information, he/she can automatically log in as the user while not need the username and password.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: 杜猛</p>
<p class="date">Created: 2017-11-13 Mon 19:39</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"></p>
</div>
</body>
</html>
